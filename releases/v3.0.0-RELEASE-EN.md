# SYSGrow v3.0.0

**Release Date:** February 22, 2026

This is a major release. v3.0.0 ships the full ML irrigation pipeline, sensor anomaly detection, an energy monitoring layer, and a round of architectural improvements that make the backend a lot easier to extend and maintain. A lot of things that were sketched out in earlier sprints are now fully wired and production-hardened.

---

## What's New

### Irrigation ML — Four Models, One Goal

The core new feature is a complete ML pipeline for smart irrigation. It learns from how you actually use the system and adjusts over time.

**Four trained models, all metrics-gated before they touch production:**

| Model | What it learns | Gate |
|---|---|---|
| **Threshold Optimizer** | When your plants actually need water | MAE ≤ 4% or R² ≥ 0.55 |
| **Response Predictor** | Whether you'll approve, delay, or cancel a request | Macro F1 ≥ 0.55, Balanced accuracy ≥ 0.55 |
| **Duration Optimizer** | How long to run the pump | MAE ≤ 25ml, MAPE ≤ 40% |
| **Timing Predictor** | Your preferred irrigation times | Top-3 accuracy ≥ 0.60, MRR ≥ 0.55 |

Until a model passes its gate, the system falls back to the rule-based Bayesian approach. No regressions.

**New API endpoints:**
```
GET  /api/v1/ml/irrigation/status           — Model readiness across all four models
GET  /api/v1/ml/irrigation/predictions/<id> — Prediction for a specific unit
POST /api/v1/ml/irrigation/feedback         — Record user feedback (approve/delay/cancel)
GET  /api/v1/ml/irrigation/history/<id>     — Feedback history per unit
```

### Automated Model Retraining

Models retrain themselves on a schedule without any manual intervention. Drift detection triggers out-of-schedule retraining when model performance degrades.

- Weekly retraining for threshold, response, and timing models
- Monthly retraining for the duration optimizer
- Drift-triggered retraining when prediction error exceeds thresholds
- Socket.IO real-time progress broadcasts during training
- **New:** Jobs that fail 5 consecutive times are automatically suspended and logged — no more silent retry storms

### Sensor Anomaly Detection

Every sensor reading is now checked against its historical baseline. Anomalies are persisted to the database and surfaced through the API.

```
GET /api/v1/devices/sensors/<id>/anomalies  — Anomaly history for a sensor
GET /api/v1/devices/sensors/<id>/health     — Health summary with anomaly flag
```

When a sensor can't be physically read (no hardware attached), the system returns an empty anomaly list instead of an error — which is the right behavior in a dev environment.

### Energy Monitoring

Track power consumption per actuator, per unit, over time.

```
GET /api/v1/energy/units/<id>/summary          — Usage summary
GET /api/v1/energy/units/<id>/history          — Historical data
GET /api/v1/energy/analytics/comparison        — Cross-unit comparison
GET /api/v1/energy/analytics/forecast          — Consumption forecast
```

### Plant Health AI

The plant health pipeline is now fully wired end to end:

- Continuous environmental monitoring with configurable alert thresholds
- Disease risk prediction using gradient-boosted classifiers
- Health scoring with per-factor breakdown (temperature, humidity, soil moisture, light, CO₂)
- AI-generated care recommendations based on current conditions

### Personalized Learning

The system builds a recommendation profile per user over time. The more you interact with it, the more relevant the suggestions become. Profiles are stored per growth unit and can be reset.

```
GET  /api/v1/ml/personalized/profiles/<unit_id>            — Get current profile
GET  /api/v1/ml/personalized/recommendations/<unit_id>     — Get tailored recommendations
POST /api/v1/ml/personalized/profiles/<unit_id>/reset      — Start fresh
```

---

## Stability and Infrastructure

### API Response Envelope

All API endpoints now return a consistent `{ok, data, error}` envelope:

```json
{
  "ok": true,
  "data": { ... },
  "error": null
}
```

Error responses:
```json
{
  "ok": false,
  "data": null,
  "error": { "message": "...", "code": "..." }
}
```

The global frontend client (`apiRequest`) unwraps this automatically, so most call sites don't see it.

### Model Registry — Atomic Writes

The `registry.json` file is now written atomically (temp file + rename). A crash during a save no longer leaves the registry in a corrupt state.

### Architectural Cleanup

- `ActuatorType` enum unified to a single canonical source with a `_missing_` hook for legacy values
- All raw SQL removed from blueprint controllers — moved to `DatabaseMaintenanceService`
- Uptime calculation delegated to `SystemHealthService` (no more `_SERVER_START_TIME` global)
- `determine_landing_page` business logic moved to `GrowthService`
- `log_if_available()` helper reduces boilerplate throughout the activity logger
- Seasonal adjustments now use real sun-times data when `SunTimesService` is configured, with a month-based heuristic as fallback

---

## Breaking Changes

- None for the HTTP API — all existing endpoints remain backward-compatible.
- The internal `_SERVER_START_TIME` module-level variable is removed. If you have custom tooling that reads it directly, switch to `SystemHealthService.get_uptime()`.
- `get_default_camera_settings()` replaces the old `get_camera_settings()` function. The old name is kept as an alias but will be removed in v4.

---

## Bug Fixes

- Fixed doubled `/api/plants/plants/` paths in the frontend client that caused 404s on plant-related pages
- Fixed `/api/ml/health` returning 500 due to missing response envelope
- Fixed plant detail page failing to load because the local API helper was checking `res.success` against a response that used `res.ok`
- Fixed energy analytics pages incorrectly checking `response.ok` after `apiRequest` had already unwrapped the envelope
- Fixed sensor anomaly endpoint returning 400 when sensor hardware is not connected

---

## What's Coming

- v3.1: Growth stage CV model (image-based stage detection)
- v3.2: Multi-unit irrigation coordination
- Long term: LLM advisor integration (groundwork is already in place)

---

*Questions or issues? Open a ticket or check the docs at `docs/ai_ml/`.*
