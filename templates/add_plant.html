{% extends 'base.html' %}
<<<<<<< HEAD

{% block content %}
<div class="page-shell">
    {{ ui.page_header(
        title="Add New Plant",
        icon="fas fa-seedling",
        subtitle="Easily add and manage plants in your SYSGrow system",
        actions='<span class="status-pill status-pill--success"><i class="fas fa-seedling me-1"></i> Plant Management</span>'
    ) }}

    <div class="row justify-content-center">
        <div class="col-lg-10">
            {% call ui.content_card(title="Plant Details", icon="fas fa-plus-circle") %}
                <form method="post" action="{{ url_for('ui.add_plant') }}" class="settings-form modern-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    
                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            {% call ui.select_field('plant_select', 'Select Plant Type', [], name_attr='plant_select', required=True, wrapper_class='form-field', help_text='Choose from our plant database') %}
                                <option value="" disabled selected>Search plants...</option>
                                {% for plant in plants_data %}
                                <option value="{{ plant['id'] }}" 
                                        data-species="{{ plant['species'] }}"
                                        data-common="{{ plant['common_name'] }}"
                                        data-variety="{{ plant['variety'] }}"
                                        data-ph="{{ plant['pH_range'] }}"
                                        data-water="{{ plant['water_requirements'] }}"
                                        data-soil-min="{{ plant.get('sensor_requirements', {}).get('soil_moisture_range', {}).get('min', '') }}"
                                        data-soil-max="{{ plant.get('sensor_requirements', {}).get('soil_moisture_range', {}).get('max', '') }}"
                                        data-temp-min="{{ plant.get('sensor_requirements', {}).get('soil_temperature_C', {}).get('min', '') }}"
                                        data-temp-max="{{ plant.get('sensor_requirements', {}).get('soil_temperature_C', {}).get('min', '') }}"
                                        data-co2-min="{{ plant.get('sensor_requirements', {}).get('co2_requirements', {}).get('min', '') }}"
                                        data-co2-max="{{ plant.get('sensor_requirements', {}).get('co2_requirements', {}).get('max', '') }}"
                                        data-difficulty="{{ plant.get('yield_data', {}).get('difficulty_level', '') }}">
                                    {{ plant['common_name'] }} - {{ plant['variety'] }}
                                </option>
                                {% endfor %}
                            {% endcall %}
                        </div>
                        <div class="col-md-6">
                            {{ ui.form_field('name', 'Plant Name', name_attr='name', required=True, placeholder='Give your plant a name', wrapper_class='form-field') }}
                        </div>
                    </div>

                    <div id="plant-meta-info" class="p-3 bg-light rounded border mb-4" style="display: none;">
                        <h4 class="h6 mb-3"><i class="fas fa-info-circle me-1 text-primary"></i> Catalog Information</h4>
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ ui.form_field('plant_type', 'Species', readonly=True, wrapper_class='form-field') }}
                            </div>
                            <div class="col-md-6">
                                {{ ui.form_field('common_name', 'Common Name', readonly=True, wrapper_class='form-field') }}
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            {% call ui.select_field('unit_id', 'Growth Unit', [], required=True, wrapper_class='form-field') %}
                                <option value="" disabled selected>Select unit...</option>
                                {% for unit in units %}
                                    <option value="{{ unit.unit_id }}">{{ unit.name }}</option>
                                {% endfor %}
                            {% endcall %}
                        </div>
                        <div class="col-md-6">
                            {{ ui.form_field('variety', 'Variety', placeholder='e.g. Cherry, Beefsteak', wrapper_class='form-field') }}
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            {% call ui.select_field('stage', 'Growth Stage', [], wrapper_class='form-field') %}
                                <option value="seedling">Seedling</option>
                                <option value="vegetative">Vegetative</option>
                                <option value="flowering">Flowering</option>
                                <option value="fruiting">Fruiting</option>
                            {% endcall %}
                        </div>
                        <div class="col-md-4">
                            {{ ui.form_field('pot_size_liters', 'Pot Size (L)', type='number', step='0.1', value='11.4', wrapper_class='form-field') }}
                        </div>
                        <div class="col-md-4">
                            {% call ui.select_field('pot_material', 'Pot Material', [], wrapper_class='form-field') %}
                                <option value="plastic">Plastic</option>
                                <option value="fabric">Fabric</option>
                                <option value="clay">Clay</option>
                                <option value="ceramic">Ceramic</option>
                            {% endcall %}
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            {% call ui.select_field('growing_medium', 'Growing Medium', [], wrapper_class='form-field') %}
                                <option value="soil">Soil</option>
                                <option value="coco_coir">Coco Coir</option>
                                <option value="hydroponics">Hydroponics</option>
                                <option value="perlite_mix">Perlite Mix</option>
                            {% endcall %}
                        </div>
                        <div class="col-md-6">
                            {{ ui.form_field('medium_ph', 'Medium pH', type='number', step='0.1', value='7.0', wrapper_class='form-field') }}
                        </div>
                    </div>

                    <!-- Additional Plant Requirements (Hidden) -->
                    <input type="hidden" id="ph_range" name="ph_range">
                    <input type="hidden" id="water_requirements" name="water_requirements">
                    <input type="hidden" id="soil_moisture_min" name="soil_moisture_min">
                    <input type="hidden" id="soil_moisture_max" name="soil_moisture_max">
                    <input type="hidden" id="soil_temp_min" name="soil_temp_min">
                    <input type="hidden" id="soil_temp_max" name="soil_temp_max">
                    <input type="hidden" id="co2_min" name="co2_min">
                    <input type="hidden" id="co2_max" name="co2_max">
                    <input type="hidden" id="difficulty_level" name="difficulty_level">

                    <!-- Plant Requirements Display -->
                    <div id="plant_requirements" class="requirements-display card bg-light mb-4 d-none">
                        <div class="card-body">
                            <h4 class="h6 mb-3"><i class="fas fa-info-circle me-1 text-primary"></i> Environment Requirements</h4>
                            <div class="row g-3">
                                <div class="col-6 col-md-4"><small class="text-muted d-block">pH Range</small><span id="display_ph" class="fw-bold">-</span></div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">Soil Moisture</small><span id="display_soil_moisture" class="fw-bold">-</span>%</div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">Soil Temp</small><span id="display_soil_temp" class="fw-bold">-</span>¬∞C</div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">CO‚ÇÇ Range</small><span id="display_co2" class="fw-bold">-</span> ppm</div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">Water Needs</small><span id="display_water" class="fw-bold">-</span></div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">Difficulty</small><span id="display_difficulty" class="fw-bold">-</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions d-flex gap-2 justify-content-end border-top pt-4">
                        <a href="{{ url_for('ui.plants') }}" class="btn btn-secondary">Cancel</a>
                        {{ ui.ui_button('Add Plant to System', type='submit', variant='primary', icon='fas fa-plus') }}
                    </div>
                </form>
            {% endcall %}

            <!-- Plant Information Guide -->
            {% call ui.content_card(title="Growth Stages Guide", icon="fas fa-info-circle", class="mt-4") %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Growth Stage</th>
                                <th>Description</th>
                                <th>Typical Duration</th>
                                <th>Key Requirements</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-secondary">Germination</span></td>
                                <td>Seed sprouting and initial root development</td>
                                <td class="text-muted">3-10 days</td>
                                <td>Warmth, moisture, darkness</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info">Seedling</span></td>
                                <td>First leaves appear, establishing root system</td>
                                <td class="text-muted">2-4 weeks</td>
                                <td>Gentle light, consistent moisture</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">Vegetative</span></td>
                                <td>Rapid stem and leaf growth</td>
                                <td class="text-muted">4-8 weeks</td>
                                <td>High nitrogen, robust lighting</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-warning text-dark">Flowering</span></td>
                                <td>Bud formation and blooming</td>
                                <td class="text-muted">Varies by species</td>
                                <td>Phosphorus/Potassium, light cycle change</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">Fruiting</span></td>
                                <td>Development of edible fruits/vegetables</td>
                                <td class="text-muted">Until harvest</td>
                                <td>Consistent water, nutrient density</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            {% endcall %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('plant_select').addEventListener('change', function() {
        const selected = this.options[this.selectedIndex];
        if (!selected.value) return;

        // Populate hidden fields
        document.getElementById('plant_type').value = selected.dataset.species;
        document.getElementById('common_name').value = selected.dataset.common;
        document.getElementById('variety').value = selected.dataset.variety;
        document.getElementById('ph_range').value = selected.dataset.ph;
        document.getElementById('water_requirements').value = selected.dataset.water;
        document.getElementById('soil_moisture_min').value = selected.dataset.soilMin;
        document.getElementById('soil_moisture_max').value = selected.dataset.soilMax;
        document.getElementById('soil_temp_min').value = selected.dataset.tempMin;
        document.getElementById('soil_temp_max').value = selected.dataset.tempMax;
        document.getElementById('co2_min').value = selected.dataset.co2Min;
        document.getElementById('co2_max').value = selected.dataset.co2Max;
        document.getElementById('difficulty_level').value = selected.dataset.difficulty;
        
        // Show meta section
        document.getElementById('plant-meta-info').style.display = 'block';
        
        // Show and populate requirements
        const reqDisplay = document.getElementById('plant_requirements');
        reqDisplay.classList.remove('d-none');
        document.getElementById('display_ph').textContent = selected.dataset.ph || 'N/A';
        document.getElementById('display_soil_moisture').textContent = (selected.dataset.soilMin && selected.dataset.soilMax) ? 
            `${selected.dataset.soilMin}-${selected.dataset.soilMax}` : 'N/A';
        document.getElementById('display_soil_temp').textContent = (selected.dataset.tempMin && selected.dataset.tempMax) ? 
            `${selected.dataset.tempMin}-${selected.dataset.tempMax}` : 'N/A';
        document.getElementById('display_co2').textContent = (selected.dataset.co2Min && selected.dataset.co2Max) ? 
            `${selected.dataset.co2Min}-${selected.dataset.co2Max}` : 'N/A';
        document.getElementById('display_water').textContent = selected.dataset.water || 'N/A';
        document.getElementById('display_difficulty').textContent = selected.dataset.difficulty || 'N/A';
    });
</script>
{% endblock %}
                
                {{ ui.form_field('variety', 'Variety:', readonly=True) }}
                
                {% call ui.select_field('soil_sensor', 'Link to Soil Moisture Sensor:', placeholder='No sensor linked') %}
                    {% for device in esp32_devices %}
                        {% for i in range(device.soil_sensor_count or 4) %}
                        <option value="{{ device.device_id }}_sensor_{{ i }}">
                            {{ device.device_name }} - Sensor {{ i + 1 }} ({{ device.location }})
                        </option>
                        {% endfor %}
                    {% endfor %}
                {% endcall %}
                
                {{ ui.select_field('stage', 'Current Stage:', [
                    ('Germination','Germination'),
                    ('Seedling','Seedling'),
                    ('Vegetative','Vegetative'),
                    ('Flowering','Flowering'),
                    ('Fruit Development','Fruit Development'),
                    ('Harvest Ready','Harvest Ready')
                ], required=True, placeholder='Select Growth Stage') }}
                
                {{ ui.form_field('days_in_stage', 'Days in Current Stage:', type='number', min=0, placeholder='e.g., 5') }}
            </div>
            
            <!-- Additional Plant Requirements -->
            <input type="hidden" id="ph_range" name="ph_range">
            <input type="hidden" id="water_requirements" name="water_requirements">
            <input type="hidden" id="soil_moisture_min" name="soil_moisture_min">
            <input type="hidden" id="soil_moisture_max" name="soil_moisture_max">
            <input type="hidden" id="soil_temp_min" name="soil_temp_min">
            <input type="hidden" id="soil_temp_max" name="soil_temp_max">
            <input type="hidden" id="co2_min" name="co2_min">
            <input type="hidden" id="co2_max" name="co2_max">
            <input type="hidden" id="difficulty_level" name="difficulty_level">
            
            <!-- Plant Requirements Display -->
            <div id="plant_requirements" class="requirements-display hidden mt-4">
                <h4 class="mb-3">Plant Requirements</h4>
                <div class="requirements-grid">
                    <div class="req-item">
                        <strong>pH Range:</strong> <span id="display_ph">-</span>
                    </div>
                    <div class="req-item">
                        <strong>Soil Moisture:</strong> <span id="display_soil_moisture">-</span>%
                    </div>
                    <div class="req-item">
                        <strong>Soil Temperature:</strong> <span id="display_soil_temp">-</span>¬∞C
                    </div>
                    <div class="req-item">
                        <strong>CO‚ÇÇ Range:</strong> <span id="display_co2">-</span> ppm
                    </div>
                    <div class="req-item">
                        <strong>Water Needs:</strong> <span id="display_water">-</span>
                    </div>
                    <div class="req-item">
                        <strong>Difficulty:</strong> <span id="display_difficulty">-</span>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 pt-3 border-top">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-plus me-1"></i> Add Plant to System
                </button>
            </div>
        </form>
    {% endcall %}

    <!-- Plant Information Guide -->
    {% call ui.content_card(title="Growth Stages Guide", icon="info-circle") %}
        <div class="table-responsive">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th scope="col">Growth Stage</th>
                        <th scope="col">Description</th>
                        <th scope="col">Typical Duration</th>
                        <th scope="col">Key Requirements</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Germination</strong></td>
                        <td>Seed sprouting and initial root development</td>
                        <td>3-10 days</td>
                        <td>Warmth, moisture, darkness</td>
                    </tr>
                    <tr>
                        <td><strong>Seedling</strong></td>
                        <td>First leaves appear, establishing root system</td>
                        <td>2-4 weeks</td>
                        <td>Gentle light, consistent moisture</td>
                    </tr>
                    <tr>
                        <td><strong>Vegetative</strong></td>
                        <td>Rapid leaf and stem growth</td>
                        <td>4-8 weeks</td>
                        <td>Strong light, nutrients, water</td>
                    </tr>
                    <tr>
                        <td><strong>Flowering</strong></td>
                        <td>Flower bud formation and blooming</td>
                        <td>2-6 weeks</td>
                        <td>Proper light cycle, phosphorus</td>
                    </tr>
                    <tr>
                        <td><strong>Fruit Development</strong></td>
                        <td>Fruit formation and growth</td>
                        <td>4-12 weeks</td>
                        <td>Consistent water, potassium</td>
                    </tr>
                    <tr>
                        <td><strong>Harvest Ready</strong></td>
                        <td>Mature fruit ready for harvest</td>
                        <td>1-2 weeks</td>
                        <td>Reduced watering, monitoring</td>
                    </tr>
                </tbody>
            </table>
        </div>
    {% endcall %}

    <!-- Common Plant Types -->
    {% call ui.content_card(title="Popular Plant Types", icon="leaf") %}
        <div class="plant-types-grid">
            <div class="plant-type-card" data-action="fill-plant-type" data-type="Tomato" data-stage="Vegetative">
                <div class="plant-icon">üçÖ</div>
                <h3>Tomato</h3>
                <p>Fruit-bearing vine, 60-80 days</p>
            </div>
            
            plant.growth_stages.forEach(stage => {
                const row = document.createElement('tr');
                const stageCell = document.createElement('td');
                const timeCell = document.createElement('td');
                const tempCell = document.createElement('td');
                const humiCell = document.createElement('td');
                const lightCell = document.createElement('td');
                
                stageCell.innerText = stage.stage;
                timeCell.innerText = stage.time;
                tempCell.innerText = stage.temperature;
                humiCell.innerText = stage.humidity;
                lightCell.innerText = stage.lighting;
                
                row.appendChild(stageCell);
                row.appendChild(timeCell);
                row.appendChild(tempCell);
                row.appendChild(humiCell);
                row.appendChild(lightCell);
                growthStagesContainer.appendChild(row);
            });

            // Create a row for the tips and add it to the tfoot section
            const tipsRow = document.getElementById('tips-row');
            tipsRow.innerHTML = ''; // Clear previous content
            const tipsCell = document.createElement('td');

            tipsCell.setAttribute('colspan', 5); // Span the cell across all table columns
            tipsCell.innerText = "Tips: " + plant.tips;
            tipsCell.style.fontWeight = 'bold'; //  makes the tips bold

            tipsRow.appendChild(tipsCell);

            document.getElementById('table-container').style.display = 'block';
        }
    }
</script>
    
=======
{% import "macros.html" as ui with context %}

{% block title %}Add New Plant - SYSGrow{% endblock %}
{% block body_class %}units-page{% endblock %}

{% block content %}
<div class="page-shell">
    {{ ui.page_header(
        title="Add New Plant",
        icon="fas fa-seedling",
        subtitle="Easily add and manage plants in your SYSGrow system",
        actions='<span class="status-pill status-pill--success"><i class="fas fa-seedling me-1"></i> Plant Management</span>'
    ) }}

    <div class="row justify-content-center">
        <div class="col-lg-10">
            {% call ui.content_card(title="Plant Details", icon="fas fa-plus-circle") %}
                <form method="post" action="{{ url_for('ui.add_plant') }}" class="settings-form modern-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    
                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            {% call ui.select_field('plant_select', 'Select Plant Type', [], name_attr='plant_select', required=True, wrapper_class='form-field', help_text='Choose from our plant database') %}
                                <option value="" disabled selected>Search plants...</option>
                                {% for plant in plants_data %}
                                <option value="{{ plant['id'] }}" 
                                        data-species="{{ plant['species'] }}"
                                        data-common="{{ plant['common_name'] }}"
                                        data-variety="{{ plant['variety'] }}"
                                        data-ph="{{ plant['pH_range'] }}"
                                        data-water="{{ plant['water_requirements'] }}"
                                        data-soil-min="{{ plant.get('sensor_requirements', {}).get('soil_moisture_range', {}).get('min', '') }}"
                                        data-soil-max="{{ plant.get('sensor_requirements', {}).get('soil_moisture_range', {}).get('max', '') }}"
                                        data-temp-min="{{ plant.get('sensor_requirements', {}).get('soil_temperature_C', {}).get('min', '') }}"
                                        data-temp-max="{{ plant.get('sensor_requirements', {}).get('soil_temperature_C', {}).get('min', '') }}"
                                        data-co2-min="{{ plant.get('sensor_requirements', {}).get('co2_requirements', {}).get('min', '') }}"
                                        data-co2-max="{{ plant.get('sensor_requirements', {}).get('co2_requirements', {}).get('max', '') }}"
                                        data-difficulty="{{ plant.get('yield_data', {}).get('difficulty_level', '') }}">
                                    {{ plant['common_name'] }} - {{ plant['variety'] }}
                                </option>
                                {% endfor %}
                            {% endcall %}
                        </div>
                        <div class="col-md-6">
                            {{ ui.form_field('name', 'Plant Name', name_attr='name', required=True, placeholder='Give your plant a name', wrapper_class='form-field') }}
                        </div>
                    </div>

                    <div id="plant-meta-info" class="p-3 bg-light rounded border mb-4" style="display: none;">
                        <h4 class="h6 mb-3"><i class="fas fa-info-circle me-1 text-primary"></i> Catalog Information</h4>
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ ui.form_field('plant_type', 'Species', readonly=True, wrapper_class='form-field') }}
                            </div>
                            <div class="col-md-6">
                                {{ ui.form_field('common_name', 'Common Name', readonly=True, wrapper_class='form-field') }}
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            {% call ui.select_field('unit_id', 'Growth Unit', [], required=True, wrapper_class='form-field') %}
                                <option value="" disabled selected>Select unit...</option>
                                {% for unit in units %}
                                    <option value="{{ unit.unit_id }}">{{ unit.name }}</option>
                                {% endfor %}
                            {% endcall %}
                        </div>
                        <div class="col-md-6">
                            {{ ui.form_field('variety', 'Variety', placeholder='e.g. Cherry, Beefsteak', wrapper_class='form-field') }}
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            {% call ui.select_field('stage', 'Growth Stage', [], wrapper_class='form-field') %}
                                <option value="seedling">Seedling</option>
                                <option value="vegetative">Vegetative</option>
                                <option value="flowering">Flowering</option>
                                <option value="fruiting">Fruiting</option>
                            {% endcall %}
                        </div>
                        <div class="col-md-4">
                            {{ ui.form_field('pot_size_liters', 'Pot Size (L)', type='number', step='0.1', value='11.4', wrapper_class='form-field') }}
                        </div>
                        <div class="col-md-4">
                            {% call ui.select_field('pot_material', 'Pot Material', [], wrapper_class='form-field') %}
                                <option value="plastic">Plastic</option>
                                <option value="fabric">Fabric</option>
                                <option value="clay">Clay</option>
                                <option value="ceramic">Ceramic</option>
                            {% endcall %}
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            {% call ui.select_field('growing_medium', 'Growing Medium', [], wrapper_class='form-field') %}
                                <option value="soil">Soil</option>
                                <option value="coco_coir">Coco Coir</option>
                                <option value="hydroponics">Hydroponics</option>
                                <option value="perlite_mix">Perlite Mix</option>
                            {% endcall %}
                        </div>
                        <div class="col-md-6">
                            {{ ui.form_field('medium_ph', 'Medium pH', type='number', step='0.1', value='7.0', wrapper_class='form-field') }}
                        </div>
                    </div>

                    <!-- Additional Plant Requirements (Hidden) -->
                    <input type="hidden" id="ph_range" name="ph_range">
                    <input type="hidden" id="water_requirements" name="water_requirements">
                    <input type="hidden" id="soil_moisture_min" name="soil_moisture_min">
                    <input type="hidden" id="soil_moisture_max" name="soil_moisture_max">
                    <input type="hidden" id="soil_temp_min" name="soil_temp_min">
                    <input type="hidden" id="soil_temp_max" name="soil_temp_max">
                    <input type="hidden" id="co2_min" name="co2_min">
                    <input type="hidden" id="co2_max" name="co2_max">
                    <input type="hidden" id="difficulty_level" name="difficulty_level">

                    <!-- Plant Requirements Display -->
                    <div id="plant_requirements" class="requirements-display card bg-light mb-4 d-none">
                        <div class="card-body">
                            <h4 class="h6 mb-3"><i class="fas fa-info-circle me-1 text-primary"></i> Environment Requirements</h4>
                            <div class="row g-3">
                                <div class="col-6 col-md-4"><small class="text-muted d-block">pH Range</small><span id="display_ph" class="fw-bold">-</span></div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">Soil Moisture</small><span id="display_soil_moisture" class="fw-bold">-</span>%</div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">Soil Temp</small><span id="display_soil_temp" class="fw-bold">-</span>¬∞C</div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">CO‚ÇÇ Range</small><span id="display_co2" class="fw-bold">-</span> ppm</div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">Water Needs</small><span id="display_water" class="fw-bold">-</span></div>
                                <div class="col-6 col-md-4"><small class="text-muted d-block">Difficulty</small><span id="display_difficulty" class="fw-bold">-</span></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions d-flex gap-2 justify-content-end border-top pt-4">
                        <a href="{{ url_for('ui.plants') }}" class="btn btn-secondary">Cancel</a>
                        {{ ui.ui_button('Add Plant to System', type='submit', variant='primary', icon='fas fa-plus') }}
                    </div>
                </form>
            {% endcall %}

            <!-- Plant Information Guide -->
            {% call ui.content_card(title="Growth Stages Guide", icon="fas fa-info-circle", class="mt-4") %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Growth Stage</th>
                                <th>Description</th>
                                <th>Typical Duration</th>
                                <th>Key Requirements</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-secondary">Germination</span></td>
                                <td>Seed sprouting and initial root development</td>
                                <td class="text-muted">3-10 days</td>
                                <td>Warmth, moisture, darkness</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-info">Seedling</span></td>
                                <td>First leaves appear, establishing root system</td>
                                <td class="text-muted">2-4 weeks</td>
                                <td>Gentle light, consistent moisture</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-primary">Vegetative</span></td>
                                <td>Rapid stem and leaf growth</td>
                                <td class="text-muted">4-8 weeks</td>
                                <td>High nitrogen, robust lighting</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-warning text-dark">Flowering</span></td>
                                <td>Bud formation and blooming</td>
                                <td class="text-muted">Varies by species</td>
                                <td>Phosphorus/Potassium, light cycle change</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-success">Fruiting</span></td>
                                <td>Development of edible fruits/vegetables</td>
                                <td class="text-muted">Until harvest</td>
                                <td>Consistent water, nutrient density</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            {% endcall %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('plant_select').addEventListener('change', function() {
        const selected = this.options[this.selectedIndex];
        if (!selected.value) return;

        // Populate hidden fields
        document.getElementById('plant_type').value = selected.dataset.species;
        document.getElementById('common_name').value = selected.dataset.common;
        document.getElementById('variety').value = selected.dataset.variety;
        document.getElementById('ph_range').value = selected.dataset.ph;
        document.getElementById('water_requirements').value = selected.dataset.water;
        document.getElementById('soil_moisture_min').value = selected.dataset.soilMin;
        document.getElementById('soil_moisture_max').value = selected.dataset.soilMax;
        document.getElementById('soil_temp_min').value = selected.dataset.tempMin;
        document.getElementById('soil_temp_max').value = selected.dataset.tempMax;
        document.getElementById('co2_min').value = selected.dataset.co2Min;
        document.getElementById('co2_max').value = selected.dataset.co2Max;
        document.getElementById('difficulty_level').value = selected.dataset.difficulty;
        
        // Show meta section
        document.getElementById('plant-meta-info').style.display = 'block';
        
        // Show and populate requirements
        const reqDisplay = document.getElementById('plant_requirements');
        reqDisplay.classList.remove('d-none');
        document.getElementById('display_ph').textContent = selected.dataset.ph || 'N/A';
        document.getElementById('display_soil_moisture').textContent = (selected.dataset.soilMin && selected.dataset.soilMax) ? 
            `${selected.dataset.soilMin}-${selected.dataset.soilMax}` : 'N/A';
        document.getElementById('display_soil_temp').textContent = (selected.dataset.tempMin && selected.dataset.tempMax) ? 
            `${selected.dataset.tempMin}-${selected.dataset.tempMax}` : 'N/A';
        document.getElementById('display_co2').textContent = (selected.dataset.co2Min && selected.dataset.co2Max) ? 
            `${selected.dataset.co2Min}-${selected.dataset.co2Max}` : 'N/A';
        document.getElementById('display_water').textContent = selected.dataset.water || 'N/A';
        document.getElementById('display_difficulty').textContent = selected.dataset.difficulty || 'N/A';
    });
</script>
{% endblock %}
                
                {{ ui.form_field('variety', 'Variety:', readonly=True) }}
                
                {% call ui.select_field('soil_sensor', 'Link to Soil Moisture Sensor:', placeholder='No sensor linked') %}
                    {% for device in esp32_devices %}
                        {% for i in range(device.soil_sensor_count or 4) %}
                        <option value="{{ device.device_id }}_sensor_{{ i }}">
                            {{ device.device_name }} - Sensor {{ i + 1 }} ({{ device.location }})
                        </option>
                        {% endfor %}
                    {% endfor %}
                {% endcall %}
                
                {{ ui.select_field('stage', 'Current Stage:', [
                    ('Germination','Germination'),
                    ('Seedling','Seedling'),
                    ('Vegetative','Vegetative'),
                    ('Flowering','Flowering'),
                    ('Fruit Development','Fruit Development'),
                    ('Harvest Ready','Harvest Ready')
                ], required=True, placeholder='Select Growth Stage') }}
                
                {{ ui.form_field('days_in_stage', 'Days in Current Stage:', type='number', min=0, placeholder='e.g., 5') }}
            </div>
            
            <!-- Additional Plant Requirements -->
            <input type="hidden" id="ph_range" name="ph_range">
            <input type="hidden" id="water_requirements" name="water_requirements">
            <input type="hidden" id="soil_moisture_min" name="soil_moisture_min">
            <input type="hidden" id="soil_moisture_max" name="soil_moisture_max">
            <input type="hidden" id="soil_temp_min" name="soil_temp_min">
            <input type="hidden" id="soil_temp_max" name="soil_temp_max">
            <input type="hidden" id="co2_min" name="co2_min">
            <input type="hidden" id="co2_max" name="co2_max">
            <input type="hidden" id="difficulty_level" name="difficulty_level">
            
            <!-- Plant Requirements Display -->
            <div id="plant_requirements" class="requirements-display hidden mt-4">
                <h4 class="mb-3">Plant Requirements</h4>
                <div class="requirements-grid">
                    <div class="req-item">
                        <strong>pH Range:</strong> <span id="display_ph">-</span>
                    </div>
                    <div class="req-item">
                        <strong>Soil Moisture:</strong> <span id="display_soil_moisture">-</span>%
                    </div>
                    <div class="req-item">
                        <strong>Soil Temperature:</strong> <span id="display_soil_temp">-</span>¬∞C
                    </div>
                    <div class="req-item">
                        <strong>CO‚ÇÇ Range:</strong> <span id="display_co2">-</span> ppm
                    </div>
                    <div class="req-item">
                        <strong>Water Needs:</strong> <span id="display_water">-</span>
                    </div>
                    <div class="req-item">
                        <strong>Difficulty:</strong> <span id="display_difficulty">-</span>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 pt-3 border-top">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-plus me-1"></i> Add Plant to System
                </button>
            </div>
        </form>
    {% endcall %}

    <!-- Plant Information Guide -->
    {% call ui.content_card(title="Growth Stages Guide", icon="info-circle") %}
        <div class="table-responsive">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th scope="col">Growth Stage</th>
                        <th scope="col">Description</th>
                        <th scope="col">Typical Duration</th>
                        <th scope="col">Key Requirements</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Germination</strong></td>
                        <td>Seed sprouting and initial root development</td>
                        <td>3-10 days</td>
                        <td>Warmth, moisture, darkness</td>
                    </tr>
                    <tr>
                        <td><strong>Seedling</strong></td>
                        <td>First leaves appear, establishing root system</td>
                        <td>2-4 weeks</td>
                        <td>Gentle light, consistent moisture</td>
                    </tr>
                    <tr>
                        <td><strong>Vegetative</strong></td>
                        <td>Rapid leaf and stem growth</td>
                        <td>4-8 weeks</td>
                        <td>Strong light, nutrients, water</td>
                    </tr>
                    <tr>
                        <td><strong>Flowering</strong></td>
                        <td>Flower bud formation and blooming</td>
                        <td>2-6 weeks</td>
                        <td>Proper light cycle, phosphorus</td>
                    </tr>
                    <tr>
                        <td><strong>Fruit Development</strong></td>
                        <td>Fruit formation and growth</td>
                        <td>4-12 weeks</td>
                        <td>Consistent water, potassium</td>
                    </tr>
                    <tr>
                        <td><strong>Harvest Ready</strong></td>
                        <td>Mature fruit ready for harvest</td>
                        <td>1-2 weeks</td>
                        <td>Reduced watering, monitoring</td>
                    </tr>
                </tbody>
            </table>
        </div>
    {% endcall %}

    <!-- Common Plant Types -->
    {% call ui.content_card(title="Popular Plant Types", icon="leaf") %}
        <div class="plant-types-grid">
            <div class="plant-type-card" data-action="fill-plant-type" data-type="Tomato" data-stage="Vegetative">
                <div class="plant-icon">üçÖ</div>
                <h3>Tomato</h3>
                <p>Fruit-bearing vine, 60-80 days</p>
            </div>
            
            <div class="plant-type-card" data-action="fill-plant-type" data-type="Lettuce" data-stage="Seedling">
                <div class="plant-icon">ü•¨</div>
                <h3>Lettuce</h3>
                <p>Leafy green, 30-45 days</p>
            </div>
            
            <div class="plant-type-card" data-action="fill-plant-type" data-type="Basil" data-stage="Seedling">
                <div class="plant-icon">üåø</div>
                <h3>Basil</h3>
                <p>Aromatic herb, 20-30 days</p>
            </div>
            
            <div class="plant-type-card" data-action="fill-plant-type" data-type="Pepper" data-stage="Vegetative">
                <div class="plant-icon">üå∂Ô∏è</div>
                <h3>Pepper</h3>
                <p>Spicy fruit, 70-90 days</p>
            </div>
            
            <div class="plant-type-card" data-action="fill-plant-type" data-type="Spinach" data-stage="Seedling">
                <div class="plant-icon">ü•¨</div>
                <h3>Spinach</h3>
                <p>Nutritious green, 25-35 days</p>
            </div>
            
            <div class="plant-type-card" data-action="fill-plant-type" data-type="Cucumber" data-stage="Vegetative">
                <div class="plant-icon">ü•í</div>
                <h3>Cucumber</h3>
                <p>Climbing vine, 50-70 days</p>
            </div>
        </div>
    {% endcall %}
</div>

<script type="module" src="{{ url_for('static', filename='js/add_plant.js') }}"></script>
>>>>>>> update
{% endblock %}
